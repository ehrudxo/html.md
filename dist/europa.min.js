/*! Europa v4.0.0-alpha3 | (C) 2016 Alasdair Mercer, Skelp | MIT License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("europa",e):t.europa=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),n=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function n(e,r){t(this,n),this.transformer=e,this.options=r,this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0,this.buffer="",this.inCodeBlock=!1,this.inOrderedList=!1,this.inPreformattedBlock=!1,this.last=null,this.left="\n",this.listDepth=0,this.listIndex=1,this.pluginStack=[],this.skipChildren=!1,this._document=e.document,this._element=null,this._tagName=null,this._window=e.window}return e(n,[{key:"append",value:function(t){return null!=this.last&&(this.buffer+=this.last),this.last=t,this}},{key:"appendParagraph",value:function(){return this.atParagraph?this:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWhiteSpace=!0,this.atParagraph=!0,this)}},{key:"output",value:function(t,e){if(!t)return this;if(t=t.replace(/\r\n/g,"\n"),e){t=t.replace(/\n([ \t]*\n)+/g,"\n").replace(/\n[ \t]+/g,"\n").replace(/[ \t]+/g," ");var r=!0,i=!1,a=void 0;try{for(var u,s=Object.entries(n.REPLACEMENTS)[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var l=o(u.value,2),f=l[0],p=l[1];t=t.replace(n.REPLACEMENTS_REGEXP[f],p)}}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}}return this.inPreformattedBlock||(t=this.atNoWhiteSpace?t.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(t)?t.replace(/^[ \t\n]+/,"\n"):t.replace(/^[ \t]+/," ")),t?(this.atLeft=/\n$/.test(t),this.atNoWhiteSpace=/[ \t\n]$/.test(t),this.atParagraph=/\n{2}$/.test(t),this.append(t.replace(/\n/g,this.left))):this}},{key:"replaceLeft",value:function(t){return this.atLeft?this.last&&(this.last=this.last.replace(/[ ]{2,4}$/,t)):(this.append(this.left.replace(/[ ]{2,4}$/,t)),this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0),this}},{key:"document",get:function(){return this._document}},{key:"element",get:function(){return this._element},set:function(t){this._element=t,this._tagName=t&&t.tagName?t.tagName.toLowerCase():null}},{key:"tagName",get:function(){return this._tagName}},{key:"window",get:function(){return this._window},set:function(t){this._window=t,this._document=t?t.document:null}}]),n}();a.REPLACEMENTS={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},a.REPLACEMENTS_REGEXP={};var u=!0,s=!1,l=void 0;try{for(var f,p=Object.keys(a.REPLACEMENTS)[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;a.REPLACEMENTS_REGEXP[h]=new RegExp(h,"g")}}catch(t){s=!0,l=t}finally{try{!u&&p.return&&p.return()}finally{if(s)throw l}}var c=function(){function n(e,r){t(this,n),this.window=e,this.document=e.document,this._plugins=r}return e(n,[{key:"transform",value:function(t,e){if(!t)return"";var n=void 0;"string"==typeof t?(n=this._document.createElement("div"),n.innerHTML=t):n=t;var r=new a(this,e),i=!0,o=!1,u=void 0;try{for(var s,l=this._plugins.values()[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var f=s.value;f.beforeAll(r)}}catch(t){o=!0,u=t}finally{try{!i&&l.return&&l.return()}finally{if(o)throw u}}this.transformElement(n,r);var p=!0,h=!1,c=void 0;try{for(var d,y=this._plugins.values()[Symbol.iterator]();!(p=(d=y.next()).done);p=!0){var v=d.value;v.afterAll(r)}}catch(t){h=!0,c=t}finally{try{!p&&y.return&&y.return()}finally{if(h)throw c}}return r.append("").buffer.trim()}},{key:"transformElement",value:function(t,e){if(t&&this._isVisible(t))if(t.nodeType===this.window.Node.ELEMENT_NODE){e.element=t;var n=new Map,r=this._plugins.get(e.tagName);if(r&&(e.pluginStack.push(r),r.before(e,n),r.transform(e,n)),!e.skipChildren){var i=!0,o=!1,a=void 0;try{for(var u,s=Array.from(t.childNodes)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var l=u.value;this.transformElement(l,e)}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}}r&&(r.after(e,n),e.pluginStack.pop())}else if(t.nodeType===this.window.Node.TEXT_NODE){var f=t.nodeValue||"";e.inPreformattedBlock?e.output(f):e.inCodeBlock?e.output(f.replace(/`/g,"\\`")):e.output(f,!0)}}},{key:"_isVisible",value:function(t){var e=this.window.getComputedStyle(t);return"none"!==e.getPropertyValue("display")&&"hidden"!==e.getPropertyValue("visibility")}}]),n}(),d=function(){function n(){t(this,n)}return e(n,[{key:"after",value:function(t,e){}},{key:"afterAll",value:function(t){}},{key:"before",value:function(t,e){}},{key:"beforeAll",value:function(t){}},{key:"transform",value:function(t,e){}}]),n}(),y=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){e.has("value")&&t.output("]"+e.get("value"))}},{key:"afterAll",value:function(t){if(this._anchors.length){t.append("\n\n");for(var e=0;e<this._anchors.length;e++)t.append("[anchor"+e+"]: "+this._anchors[e]+"\n")}}},{key:"beforeAll",value:function(t){this._anchorMap=new Map,this._anchors=[]}},{key:"transform",value:function(t,e){var n=t.element,r=t.options,i=r.absolute?n.href:n.getAttribute("href");if(i){var o=n.getAttribute("title"),a=o?i+' "'+o+'"':i;if(r.inline)e.set("value","("+a+")");else{var u=this._anchorMap.get(a);null==u&&(u=this._anchors.push(a)-1,this._anchorMap.set(a,u)),e.set("value","[anchor"+u+"]")}t.output("["),t.atNoWhiteSpace=!0}}}]),o}(d),v=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.atLeft=!1,t.atParagraph=!1,t.left=e.get("previousLeft"),t.appendParagraph()}},{key:"before",value:function(t,e){e.set("previousLeft",t.left)}},{key:"transform",value:function(t,e){var n="> ";t.left+=n,t.atParagraph?t.append(n):t.appendParagraph()}}]),o}(d),g=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"transform",value:function(t,e){t.append("  "+t.left),t.atLeft=!0,t.atNoWhiteSpace=!0}}]),o}(d),_=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){e.get("skipped")||(t.inCodeBlock=e.get("previousInCodeBlock"),t.output("`"))}},{key:"before",value:function(t,e){e.set("previousInCodeBlock",t.inCodeBlock)}},{key:"transform",value:function(t,e){t.inPreformattedBlock?e.set("skipped",!0):(t.output("`"),t.inCodeBlock=!0)}}]),o}(d),m=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.output("**")}},{key:"transform",value:function(t,e){t.output("**"),t.atNoWhiteSpace=!0}}]),o}(d),k=function(o){function a(){return t(this,a),i(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return r(a,o),e(a,[{key:"transform",value:function(t,e){t.appendParagraph(),n(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"transform",this).call(this,t,e)}}]),a}(m),w=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.skipChildren=e.get("previousSkipChildren")}},{key:"before",value:function(t,e){e.set("previousSkipChildren",t.skipChildren)}},{key:"transform",value:function(t,e){var n=t.element;if(t.appendParagraph(),!n.hasAttribute("open")){t.skipChildren=!0;var r=n.querySelector("summary");t.transformer.transformElement(r,t)}}}]),o}(d),b=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.output("_")}},{key:"transform",value:function(t,e){t.output("_"),t.atNoWhiteSpace=!0}}]),o}(d),P=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.skipChildren=e.get("previousSkipChildren")}},{key:"before",value:function(t,e){e.set("previousSkipChildren",t.skipChildren)}},{key:"transform",value:function(t,e){t.skipChildren=!0}}]),o}(d),O=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"transform",value:function(t,e){var n=parseInt(t.tagName.match(/([1-6])$/)[1],10);t.appendParagraph();for(var r="",i=0;i<n;i++)r+="#";t.output(r+" ")}}]),o}(d),S=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"transform",value:function(t,e){t.appendParagraph().output("---").appendParagraph()}}]),o}(d),L=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.skipChildren=e.get("previousSkipChildren")}},{key:"afterAll",value:function(t){if(this._images.length){t.append("\n\n");for(var e=0;e<this._images.length;e++)t.append("[image"+e+"]: "+this._images[e]+"\n")}}},{key:"before",value:function(t,e){e.set("previousSkipChildren",t.skipChildren)}},{key:"beforeAll",value:function(t){this._imageMap=new Map,this._images=[]}},{key:"transform",value:function(t,e){t.skipChildren=!0;var n=t.element,r=t.options,i=r.absolute?n.src:n.getAttribute("src");if(i){var o=n.getAttribute("alt")||"",a=n.getAttribute("title"),u=a?i+' "'+a+'"':i;if(r.inline)u="("+u+")";else{var s=this._imageMap.get(u);null==s&&(s=this._images.push(u)-1,this._imageMap.set(u,s)),u="[image"+s+"]"}t.output("!["+o+"]"+u)}}}]),o}(d),E=function(){function n(){t(this,n)}return e(n,null,[{key:"leftPad",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?" ":arguments[2];if(!n)return t;for(var r=0;r<e;r++)t=n+t;return t}},{key:"throwUnimplemented",value:function(t,e){throw new Error('"'+e+'" method must be implemented on the '+t+" class")}}]),n}(),C=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"transform",value:function(t,e){var n=t.inOrderedList?t.listIndex++ +". ":"* ";t.atLeft?t.last&&(t.last=t.last.replace(/[ ]{2,4}$/,"\n")):(t.append(t.left.replace(/[ ]{2,4}$/,"\n")),t.atLeft=!0,t.atNoWhiteSpace=!0,t.atParagraph=!0),t.append(E.leftPad(n,2*(t.listDepth-1)))}}]),o}(d),j=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.inOrderedList=e.get("previousInOrderedList"),t.listIndex=e.get("previousListIndex"),t.listDepth--}},{key:"before",value:function(t,e){e.set("previousInOrderedList",t.inOrderedList),e.set("previousListIndex",t.listIndex)}},{key:"transform",value:function(t,e){0===t.listDepth&&t.appendParagraph(),t.inOrderedList=!0,t.listIndex=1,t.listDepth++}}]),o}(d),N=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"transform",value:function(t,e){t.appendParagraph()}}]),o}(d),x=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.atLeft=!1,t.atParagraph=!1,t.inPreformattedBlock=e.get("previousInPreformattedBlock"),t.left=e.get("previousLeft"),t.appendParagraph()}},{key:"before",value:function(t,e){e.set("previousInPreformattedBlock",t.inPreformattedBlock),e.set("previousLeft",t.left)}},{key:"transform",value:function(t,e){var n="    ";t.left+=n,t.atParagraph?t.append(n):t.appendParagraph()}}]),o}(d),A=function(){function n(){t(this,n),this._plugins=new Map}return e(n,[{key:"set",value:function(t,e){return this._plugins.set(t,e),this}},{key:"setAll",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=o(i.value,2),s=u[0],l=u[1];this._plugins.set(s,l)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return this}},{key:"plugins",get:function(){return new Map(this._plugins)}}]),n}(),I=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.output('"')}},{key:"transform",value:function(t,e){t.output('"'),t.atNoWhiteSpace=!0}}]),o}(d),M=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"after",value:function(t,e){t.inOrderedList=e.get("previousInOrderedList"),t.listIndex=e.get("previousListIndex"),t.listDepth--}},{key:"before",value:function(t,e){e.set("previousInOrderedList",t.inOrderedList),e.set("previousListIndex",t.listIndex)}},{key:"transform",value:function(t,e){0===t.listDepth&&t.appendParagraph(),t.inOrderedList=!1,t.listIndex=1,t.listDepth++}}]),o}(d),B=(new A).set(["a"],new y).set(["blockquote","dd"],new v).set(["br"],new g).set(["code","kbd","samp"],new _).set(["dt"],new k).set(["details"],new w).set(["cite","dfn","em","i","u","var"],new b).set(["applet","area","audio","button","canvas","datalist","embed","head","input","map","menu","meter","noframes","noscript","object","optgroup","option","param","progress","rp","rt","ruby","script","select","style","textarea","title","video"],new P).set(["h1","h2","h3","h4","h5","h6"],new O).set(["hr"],new S).set(["img"],new L).set(["li"],new C).set(["ol"],new j).set(["address","article","aside","div","fieldset","footer","header","nav","p","section"],new N).set(["pre"],new x).set(["q"],new I).set(["b","strong"],new m).set(["ul"],new M),W=function(){function n(e){t(this,n),this._windowService=e,this._window=null,this._plugins=new Map,this.registerPreset(B)}return e(n,[{key:"destroy",value:function(){return this._window&&(this._windowService.closeWindow(this._window),this._window=null),this}},{key:"register",value:function(t,e){"string"==typeof t&&(t=t.trim().split(/\s+/));var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;this._plugins.set(u.toLowerCase(),e)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return this}},{key:"registerPreset",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t.plugins[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=o(i.value,2),s=u[0],l=u[1];this.register(s,l)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return this}},{key:"transform",value:function(t,e){var n=this.window,r=new c(n,this._plugins);return e=this._createTransformationOptions(e),r.transform(t,e)}},{key:"_createTransformationOptions",value:function(t){return Object.assign({absolute:!1,baseUri:this._windowService.getBaseUri(this.window),inline:!1},t)}},{key:"window",get:function(){return null==this._window&&(this._window=this._windowService.getWindow()),this._window}}]),n}(),T=function(){function n(){t(this,n)}return e(n,[{key:"closeWindow",value:function(t){this.isCloseable(t)&&t.close()}},{key:"getBaseUri",value:function(t){E.throwUnimplemented("WindowService","getBaseUri")}},{key:"getWindow",value:function(){E.throwUnimplemented("WindowService","getWindow")}},{key:"isCloseable",value:function(t){return!1}}]),n}(),R=function(n){function o(){return t(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,n),e(o,[{key:"getBaseUri",value:function(t){return t.document.baseURI}},{key:"getWindow",value:function(){return window}}]),o}(T),D=new W(new R);return D});
//# sourceMappingURL=europa.min.js.map